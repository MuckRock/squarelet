(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))i(t);new MutationObserver(t=>{for(const s of t)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function r(t){const s={};return t.integrity&&(s.integrity=t.integrity),t.referrerPolicy&&(s.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?s.credentials="include":t.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(t){if(t.ep)return;t.ep=!0;const s=r(t);fetch(t.href,s)}})();function o(n){return document.getElementById(n)}function d(n){return document.getElementById(n)!=null}function a(n,e,r){Array.isArray(e)?e.forEach(i=>n.addEventListener(i,r,!1)):n.addEventListener(e,r,!1)}function x(n,e="GET"){return new Promise((r,i)=>{const t=new XMLHttpRequest;t.onload=()=>{const s=t.status;s>=200&&s<300?r(t.responseText):i(`${s}: ${t.responseText}`)},t.open(e,n),t.send()})}function y(n){n.classList.remove("_cls-hide")}function C(n){n.classList.add("_cls-hide")}const E=40;class w{constructor(){this.filter=o("_id-filter"),this.close=o("_id-close"),this.results=o("_id-results"),this.page=1,this.morePages=!0,this.currentSearch="",this.currentPage=1,this.async=null,a(this.close,"click",()=>{this.filter.value="",this.page=1,this.morePages=!0,this.fetch("")}),a(this.filter,"input",()=>{this.resetAsync(),this.page=1,this.morePages=!0,this.fetch(this.filter.value)}),a(this.results,"scroll",()=>{const e=this.results.scrollTop+this.results.offsetHeight;this.page==this.currentPage&&e>this.results.scrollHeight-E&&this.nextPage()})}resetAsync(){this.async=null}clearResults(){for(;this.results.firstChild;)this.results.removeChild(this.results.firstChild)}render(e,r,i=""){r||this.clearResults();for(const t of e)this.addResult(t.name,t.slug,t.avatar,i);this.results.scrollHeight<this.results.offsetHeight+E&&this.nextPage()}addResult(e,r,i,t=""){const s=document.createElement("a");s.href=r;const l=document.createElement("div");l.className="_cls-result";const c=document.createElement("div");c.className="_cls-inlineAvatar";const p=document.createElement("img");if(p.src=i,p.width=22,p.height=22,c.appendChild(p),l.appendChild(c),t==""){const m=document.createElement("span");m.textContent=e,l.appendChild(m)}else{const m=t.toLowerCase();let u=e.toLowerCase();for(;;){let h=u.indexOf(m);if(h!=-1){const f=document.createElement("span");f.textContent=e.substring(0,h),l.appendChild(f);const g=document.createElement("b");g.textContent=e.substr(h,t.length),e=e.substr(h+t.length),u=u.substr(h+t.length),l.appendChild(g)}else{const f=document.createElement("span");f.textContent=e,l.appendChild(f);break}}}s.appendChild(l),this.results.appendChild(s)}fetch(e,r=!1){r||(this.results.scrollTop=0);const i=this.page;this.currentSearch=e,this.async=x(`autocomplete?q=${e}&page=${i}`).then(t=>{const s=JSON.parse(t);if(this.currentSearch==e&&this.page==i){const l=s.data;this.currentPage=i,l.length==0&&(this.morePages=!1),this.render(l,r,e),this.async=null}})}nextPage(){this.morePages&&(this.page++,this.fetch(this.filter.value,!0))}}class v{constructor(){this.dropdown=o("_id-profDropdown"),this.contents=o("_id-dropdownContents"),this.shim=o("_id-shim"),this.hidden=!0,a(this.dropdown,"click",()=>{this.hidden?this.show():this.hide()}),a(this.shim,"click",()=>{this.hide()})}show(){this.hidden=!1,this.dropdown.classList.add("_cls-active"),y(this.contents),y(this.shim)}hide(){this.hidden=!0,this.dropdown.classList.remove("_cls-active"),C(this.contents),C(this.shim)}}class P{constructor(){this.expandActions=Array.from(document.getElementsByClassName("_cls-expandAction")),this.expanded=!1,this.expandActions.forEach(e=>{a(e,"click",()=>{if(this.expanded){this.expanded=!1,e.firstChild.textContent="Expand";const i=e.closest("._cls-manageRow").nextSibling;i.parentElement.removeChild(i)}else{this.expanded=!0,e.firstChild.textContent="Collapse";const r=e.closest("._cls-manageRow"),i=document.createElement("div");i.className="_cls-manageRow _cls-iframeRow";const t=document.createElement("iframe");t.src=`/organizations/~charge/${e.dataset.charge}/`,i.appendChild(t),r.parentElement.insertBefore(i,r.nextSibling)}})})}}const I=window.Stripe,F={base:{color:"#3F3F3F",fontSize:"18px",fontFamily:"system-ui, sans-serif",fontSmoothing:"antialiased","::placeholder":{color:"#899194"}},invalid:{color:"#e5424d",":focus":{color:"#303238"}}};class b{constructor(){this.stripePk=o("id_stripe_pk"),this.planInput=o("id_plan"),this.ucofInput=o("id_use_card_on_file"),this.rcofInput=o("id_remove_card_on_file"),this.ccFieldset=o("_id-cardFieldset"),this.removeCardFieldset=o("_id-removeCardFieldset"),this.planInfoElem=o("_id-planInfo"),this.planProjection=o("_id-planProjection"),this.cardContainer=o("card-container"),this.receiptEmails=o("_id-receiptEmails"),this.totalCost=o("_id-totalCost"),this.costBreakdown=o("_id-costBreakdown"),this.maxUsersElem=o("id_max_users"),this.planInfo=JSON.parse(this.planInfoElem.textContent),this.setupMaxUsersField(),this.setupCardOnFileField(),this.setupReceiptEmails(),this.setupStripe(),this.updateAll()}receiptResize(){this.receiptEmails.style.height="5px",this.receiptEmails.style.height=this.receiptEmails.scrollHeight+"px"}getPlan(){return this.planInfo[this.planInput.value]||this.planInfo[""]}updateTotalCost(){if(this.totalCost==null)return;const e=this.getPlan(),r=`${e.base_price+(this.maxUsers-e.minimum_users)*e.price_per_user}`,i=e.annual?"year":"month",t=`$${r} / ${i}`;this.totalCost.textContent=t;let s=`$${e.base_price} (base price)`;this.maxUsers!=0&&(this.maxUsers-e.minimum_users==0?(s+=` with ${e.minimum_users} resource block${e.minimum_users!=1?"s":""} included`,e.price_per_user!=0&&(s+=` ($${e.price_per_user} per additional resouece block)`)):s+=` with ${e.minimum_users} resource block${e.minimum_users!=1?"s":""} included and ${this.maxUsers-e.minimum_users} extra resource blocks
          at $${e.price_per_user} each`),this.costBreakdown.textContent=s}updatePlanInput(){const e=this.getPlan();this.updateTotalCost(),U(e)?(this.ccFieldset!=null&&(this.ccFieldset.style.display=""),this.removeCardFieldset!=null&&(this.removeCardFieldset.style.display="none")):(this.ccFieldset!=null&&(this.ccFieldset.style.display="none"),this.removeCardFieldset!=null&&(this.removeCardFieldset.style.display="")),_(e)?this.planProjection!=null&&(this.planProjection.style.display="none"):this.planProjection!=null&&(this.planProjection.style.display=""),this.updateAll(!1)}updateMaxUsers(){if(this.maxUsersElem==null)return;this.maxUsers=parseInt(this.maxUsersElem.value);const e=parseInt(this.maxUsersElem.min);this.maxUsers<e&&(this.maxUsersElem.value=`${e}`,this.maxUsers=e)}updateSavedCC(){if(this.ucofInput==null){this.cardContainer!=null&&(this.cardContainer.style.display="");return}document.querySelector("input[name=use_card_on_file]:checked").value=="True"&&this.ccFieldset.style.display===""?this.cardContainer!=null&&(this.cardContainer.style.display="none"):this.cardContainer!=null&&(this.cardContainer.style.display="")}updateAll(e=!0){this.updateMaxUsers(),this.updateSavedCC(),e&&this.updatePlanInput()}setupMaxUsersField(){if(d("id_max_users")){const e=this.maxUsersElem;this.maxUsers=parseInt(e.value),a(e,"blur",()=>{this.updateAll()})}else{const e=this.getPlan();this.maxUsers=e.minimum_users}}setupCardOnFileField(){d("id_use_card_on_file")&&a(this.ucofInput,"input",()=>{this.updateAll()})}setupReceiptEmails(){this.receiptEmails!=null&&(this.receiptEmails.rows=2,a(this.receiptEmails,"input",()=>this.receiptResize()),this.receiptResize())}setupStripe(){if(d("card-element")){const e=I(this.stripePk.value),i=e.elements().create("card",{style:F});i.mount("#card-element"),i.addEventListener("change",s=>{const l=s,c=document.getElementById("card-errors");l.error?c.textContent=l.error.message:c.textContent=""}),document.getElementById("id_stripe_token").value="",this.planInput.addEventListener("input",()=>{this.updateAll()}),document.getElementById("stripe-form").addEventListener("submit",s=>{const l=document.querySelector("input[name=use_card_on_file]:checked"),c=l!=null&&l.value=="True",p=this.getPlan(),m=document.querySelector("#card-element").classList.contains("StripeElement--empty");_(p)&&m||c||(s.preventDefault(),e.createToken(i).then(function(u){if(u.error){const h=document.getElementById("card-errors");h.textContent=u.error.message}else S(u.token)}))})}}}function S(n){const e=document.getElementById("id_stripe_token");e.value=n.id,document.getElementById("stripe-form").submit()}function _(n){return n.base_price==0&&n.price_per_user==0}function U(n){return!_(n)&&!n.annual}d("_id-profDropdown")&&new v;d("_id-autocomplete")&&new w;d("_id-resendVerification");d("_id-receiptsTable")&&new P;d("id_stripe_pk")&&new b;
