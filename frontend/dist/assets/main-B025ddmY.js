(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))s(t);new MutationObserver(t=>{for(const i of t)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function r(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerPolicy&&(i.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?i.credentials="include":t.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(t){if(t.ep)return;t.ep=!0;const i=r(t);fetch(t.href,i)}})();function l(n){return document.getElementById(n)}function d(n){return document.getElementById(n)!=null}function c(n,e,r){Array.isArray(e)?e.forEach(s=>n.addEventListener(s,r,!1)):n.addEventListener(e,r,!1)}function w(n,e="GET"){return new Promise((r,s)=>{const t=new XMLHttpRequest;t.onload=()=>{const i=t.status;i>=200&&i<300?r(t.responseText):s(`${i}: ${t.responseText}`)},t.open(e,n),t.send()})}function C(n){n.classList.remove("_cls-hide")}function E(n){n.classList.add("_cls-hide")}const x=40;class v{filter=l("_id-filter");close=l("_id-close");results=l("_id-results");page=1;morePages=!0;currentSearch="";currentPage=1;async=null;constructor(){c(this.close,"click",()=>{this.filter.value="",this.page=1,this.morePages=!0,this.fetch("")}),c(this.filter,"input",()=>{this.resetAsync(),this.page=1,this.morePages=!0,this.fetch(this.filter.value)}),c(this.results,"scroll",()=>{const e=this.results.scrollTop+this.results.offsetHeight;this.page==this.currentPage&&e>this.results.scrollHeight-x&&this.nextPage()})}resetAsync(){this.async=null}clearResults(){for(;this.results.firstChild;)this.results.removeChild(this.results.firstChild)}render(e,r,s=""){r||this.clearResults();for(const t of e)this.addResult(t.name,t.slug,t.avatar,s);this.results.scrollHeight<this.results.offsetHeight+x&&this.nextPage()}addResult(e,r,s,t=""){const i=document.createElement("a");i.href=r;const o=document.createElement("div");o.className="_cls-result";const a=document.createElement("span");a.className="_cls-inlineText";const p=document.createElement("div");p.className="_cls-inlineAvatar";const u=document.createElement("img");if(u.src=s,u.width=22,u.height=22,p.appendChild(u),o.appendChild(p),o.appendChild(a),t=="")a.textContent=e;else{const h=t.toLowerCase();let m=e.toLowerCase();for(;;){let f=m.indexOf(h);if(f!=-1){const _=document.createElement("span");_.textContent=e.substr(0,f),a.appendChild(_);const g=document.createElement("b");g.textContent=e.substr(f,t.length),e=e.substr(f+t.length),m=m.substr(f+t.length),a.appendChild(g)}else{const _=document.createElement("span");_.textContent=e,a.appendChild(_);break}}}i.appendChild(o),this.results.appendChild(i)}fetch(e,r=!1){r||(this.results.scrollTop=0);const s=this.page;this.currentSearch=e,this.async=w(`autocomplete?q=${e}&page=${s}`).then(t=>{const i=JSON.parse(t);if(this.currentSearch==e&&this.page==s){const o=i.data;this.currentPage=s,o.length==0&&(this.morePages=!1),this.render(o,r,e),this.async=null}})}nextPage(){this.morePages&&(this.page++,this.fetch(this.filter.value,!0))}}class P{dropdown=l("_id-profDropdown");contents=l("_id-dropdownContents");shim=l("_id-shim");hidden=!0;constructor(){c(this.dropdown,"click",()=>{this.hidden?this.show():this.hide()}),c(this.shim,"click",()=>{this.hide()})}show(){this.hidden=!1,this.dropdown.classList.add("_cls-active"),C(this.contents),C(this.shim)}hide(){this.hidden=!0,this.dropdown.classList.remove("_cls-active"),E(this.contents),E(this.shim)}}class I{expandActions=Array.from(document.getElementsByClassName("_cls-expandAction"));expanded=!1;constructor(){this.expandActions.forEach(e=>{c(e,"click",()=>{if(this.expanded){this.expanded=!1,e.firstChild.textContent="Expand";const s=e.closest("._cls-manageRow").nextSibling;s.parentElement.removeChild(s)}else{this.expanded=!0,e.firstChild.textContent="Collapse";const r=e.closest("._cls-manageRow"),s=document.createElement("div");s.className="_cls-manageRow _cls-iframeRow";const t=document.createElement("iframe");t.src=`/organizations/~charge/${e.dataset.charge}/`,s.appendChild(t),r.parentElement.insertBefore(s,r.nextSibling)}})})}}const b=window.Stripe,F={base:{color:"#3F3F3F",fontSize:"18px",fontFamily:"system-ui, sans-serif",fontSmoothing:"antialiased","::placeholder":{color:"#899194"}},invalid:{color:"#e5424d",":focus":{color:"#303238"}}};class S{stripePk=l("id_stripe_pk");planInput=l("id_plan");ucofInput=l("id_use_card_on_file");rcofInput=l("id_remove_card_on_file");ccFieldset=l("_id-cardFieldset");removeCardFieldset=l("_id-removeCardFieldset");planInfoElem=l("_id-planInfo");planProjection=l("_id-planProjection");cardContainer=l("card-container");receiptEmails=l("_id-receiptEmails");totalCost=l("_id-totalCost");costBreakdown=l("_id-costBreakdown");maxUsersElem=l("id_max_users");planInfo=JSON.parse(this.planInfoElem.textContent);maxUsers;constructor(){this.setupMaxUsersField(),this.setupCardOnFileField(),this.setupReceiptEmails(),this.setupStripe(),this.updateAll()}receiptResize(){this.receiptEmails.style.height="5px",this.receiptEmails.style.height=this.receiptEmails.scrollHeight+"px"}getPlan(){return this.planInfo[this.planInput.value]||this.planInfo[""]}updateTotalCost(){if(this.totalCost==null)return;const e=this.getPlan(),r=`${e.base_price+(this.maxUsers-e.minimum_users)*e.price_per_user}`,s=e.annual?"year":"month",t=`$${r} / ${s}`;this.totalCost.textContent=t;let i=`$${e.base_price} (base price)`;this.maxUsers!=0&&(this.maxUsers-e.minimum_users==0?(i+=` with ${e.minimum_users} resource block${e.minimum_users!=1?"s":""} included`,e.price_per_user!=0&&(i+=` ($${e.price_per_user} per additional resouece block)`)):i+=` with ${e.minimum_users} resource block${e.minimum_users!=1?"s":""} included and ${this.maxUsers-e.minimum_users} extra resource blocks
          at $${e.price_per_user} each`),this.costBreakdown.textContent=i}updatePlanInput(){const e=this.getPlan();this.updateTotalCost(),k(e)?(this.ccFieldset!=null&&(this.ccFieldset.style.display=""),this.removeCardFieldset!=null&&(this.removeCardFieldset.style.display="none")):(this.ccFieldset!=null&&(this.ccFieldset.style.display="none"),this.removeCardFieldset!=null&&(this.removeCardFieldset.style.display="")),y(e)?this.planProjection!=null&&(this.planProjection.style.display="none"):this.planProjection!=null&&(this.planProjection.style.display="");const r=document.querySelector("#id_max_users");if(r){const s=r.closest("fieldset"),t=document.querySelector("#hint_id_max_users");e.slug===""?s.style.display="none":e.slug=="organization"?(s.style.display="",t.textContent=`Your plan covers unlimited users.  By default, this organization plan
          includes 50 requests on MuckRock as well as 5,000 credits for
          DocumentCloud premium features, both renewed monthly on your billing
          date.  Each additional resource block above 5 will grant you another 10
          requests and 500 premium credits.`):(s.style.display="",t.textContent=`You have selected a custom plan.  Please contact a staff member for
          specific details on how many resources each resource block will
          provide.`)}this.updateAll(!1)}updateMaxUsers(){if(this.maxUsersElem==null)return;this.maxUsers=parseInt(this.maxUsersElem.value);const e=parseInt(this.maxUsersElem.min);this.maxUsers<e&&(this.maxUsersElem.value=`${e}`,this.maxUsers=e)}updateSavedCC(){if(this.ucofInput==null){this.cardContainer!=null&&(this.cardContainer.style.display="");return}document.querySelector("input[name=use_card_on_file]:checked").value=="True"&&this.ccFieldset.style.display===""?this.cardContainer!=null&&(this.cardContainer.style.display="none"):this.cardContainer!=null&&(this.cardContainer.style.display="")}updateAll(e=!0){this.updateMaxUsers(),this.updateSavedCC(),e&&this.updatePlanInput()}setupMaxUsersField(){if(d("id_max_users")){const e=this.maxUsersElem;this.maxUsers=parseInt(e.value),c(e,"blur",()=>{this.updateAll()})}else{const e=this.getPlan();this.maxUsers=e.minimum_users}}setupCardOnFileField(){d("id_use_card_on_file")&&c(this.ucofInput,"input",()=>{this.updateAll()})}setupReceiptEmails(){this.receiptEmails!=null&&(this.receiptEmails.rows=2,c(this.receiptEmails,"input",()=>this.receiptResize()),this.receiptResize())}setupStripe(){if(d("card-element")){const e=b(this.stripePk.value),s=e.elements().create("card",{style:F});s.mount("#card-element"),s.addEventListener("change",i=>{const o=i,a=document.getElementById("card-errors");o.error?a.textContent=o.error.message:a.textContent=""}),document.getElementById("id_stripe_token").value="",this.planInput.addEventListener("input",()=>{this.updateAll()}),document.getElementById("stripe-form").addEventListener("submit",i=>{const o=document.querySelector("input[name=use_card_on_file]:checked"),a=o!=null&&o.value=="True",p=this.getPlan(),u=document.querySelector("#card-element").classList.contains("StripeElement--empty");y(p)&&u||a||(i.preventDefault(),e.createToken(s).then(function(h){if(h.error){const m=document.getElementById("card-errors");m.textContent=h.error.message}else U(h.token)}))})}}}function U(n){const e=document.getElementById("id_stripe_token");e.value=n.id,document.getElementById("stripe-form").submit()}function y(n){return n.base_price==0&&n.price_per_user==0}function k(n){return!y(n)&&!n.annual}d("_id-profDropdown")&&new P;d("_id-autocomplete")&&new v;d("_id-resendVerification");d("_id-receiptsTable")&&new I;d("id_stripe_pk")&&new S;
