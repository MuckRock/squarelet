{% extends "base.html" %}
{% load i18n django_vite crispy_forms_tags planinfo %}

{% block title %}{{ organization.reference_name }}{% endblock %}

{% block vite %}
{{ block.super }}
{% vite_asset "frontend/views/organization_update.ts" %}
{% endblock %}

{% block content %}
<article id="organization-form">
  <aside class="sidebar">
    <header>
      <a href="{{ organization.get_absolute_url }}" class="btn small ghost primary">
        {% include "core/icons/chevron-left.svg" %}
        {% trans "Back to team overview" %}
      </a>
      <h1>{{ organization.name }}</h1>
      <h2>{% trans "Edit profile" %}</h2>
    </header>
  </aside>

  <div class="content">
    <section id="details">
      <header>
        <div class="title">
          <h2>{% trans "Organization Details" %}</h2>
          <p>{% trans "Update your organization information" %}</p>
        </div>
      </header>

      <form method="POST" action="{% url "organizations:update" slug=organization.slug %}" class="form card">
        {% crispy form form.helper %}
        <button type="submit" class="btn primary">
          {% trans "Save changes" %}
        </button>
      </form>
    </section>

    <section id="protected">
      <header>
        <div class="title">
          <h2>{% trans "Protected fields" %}</h2>
          <p>
            {% trans "Changes to these fields require approval by MuckRock staff" %}
          </p>
        </div>
      </header>

      {% if pending_change_requests %}
      <div class="card" id="pending-requests">
        <h3>{% trans "Pending Change Requests" %}</h3>
        <p>{% trans "You have the following change requests awaiting staff approval:" %}</p>
        {% for change in pending_change_requests %}
        <dl>
          <dt>{% trans "Requested on" %}</dt>
          <dd>{{ change.created_at|date:"SHORT_DATE_FORMAT" }}</dd>

          <dt>{% trans "Status" %}</dt>
          <dd>{{ change.get_status_display }}</dd>

          {% if change.name %}
          <dt>{% trans "Name" %}</dt>
          <dd>{{ change.name }}</dd>
          {% endif %}

          {% if change.slug %}
          <dt>{% trans "Slug" %}</dt>
          <dd>{{ change.slug }}</dd>
          {% endif %}

          {% if change.url %}
          <dt>URL</dt>
          <dd>{{ change.url }}</dd>
          {% endif %}

          {% if change.city %}
          <dt>{% trans "City" %}</dt>
          <dd>{{ change.city }}</dd>
          {% endif %}

          {% if change.state %}
          <dt>{% trans "State" %}</dt>
          <dd>{{ change.get_state_display }}</dd>
          {% endif %}

          {% if change.country %}
          <dt>{% trans "Country" %}</dt>
          <dd>{{ change.get_country_display }}</dd>
          {% endif %}

          {% if change.explanation %}
          <dt>{% trans "Explanation" %}</dt>
          <dd>{{ change.explanation }}</dd>
          {% endif %}

          {% if user.is_staff %}
          <h3>{% trans "Actions" %}</h3>
          <div>
            <form method="POST" action="{% url 'organizations:review-profile-change' slug=organization.slug pk=change.pk %}" style="display: inline;">
              {% csrf_token %}
              <button type="submit" class="btn small primary" value="accept">
                {% trans "Accept" %}
              </button>
            </form>
            <form method="POST" action="{% url 'organizations:review-profile-change' slug=organization.slug pk=change.pk %}" style="display: inline;">
              {% csrf_token %}
              <button type="submit" class="btn small" value="reject">
                {% trans "Reject" %}
              </button>
            </form>
          </div>
          {% endif %}
        </dl>
        {% endfor %}
      </div>
      {% endif %}
      <form method="POST" action="{% url "organizations:request-profile-change" slug=organization.slug %}" class="form card">
        {% crispy profile_change_form profile_change_form.helper %}
        
        <button type="submit" class="btn primary">
          {% if user.is_staff %}
          {% trans "Save changes" %}
          {% else %}
          {% trans "Request changes" %}
          {% endif %}
        </button>
      </form>
    </section>
  </div>

</article>
{% endblock content %}
