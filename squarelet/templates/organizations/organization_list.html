{% extends "base.html" %}
{% load static i18n avatar django_vite %}

{% block title %}Organizations{% endblock %}

{% block vite %}
{{ block.super }}
{% vite_asset "frontend/views/organization_list.ts" %}
{% endblock vite %}

{% block content %}
{% if not user.is_authenticated %}
<article id="organization_list" class="org-list-page">
  <header>
    <h1>{% trans "Organizations" %}</h1>
  </header>
  <div class="content">
    <header>
      <h1>{% trans "Organizations" %}</h1>
    </header>
    <section class="search">
      <h2>{% trans "Search organizations" %}</h2>
      <div id="org_search"></div>
    </section>
    <section class="introduction">
      <h2>{% trans "Collaborate securely and share privately within MuckRock organizations" %}</h2>
      <p>
        {% blocktrans %}
        Organization members have access to the permissions and purchases allowed by administrators.
        Designed for teams collaborating on reporting, research, and more, organizations make it easy to work together when using MuckRock's tools.
        {% endblocktrans %}
      </p>
      <div class="card">
        <p class="lead">{% blocktrans %}You need a MuckRock account to join and create organizations.{% endblocktrans %}</p>
        <div class="btn-group">
          <a class="btn primary" href="{% url 'account_login' %}?next={% url "organizations:list" %}">{% trans "Sign in" %}</a>
          <a class="btn ghost" href="{% url 'account_signup' %}?next={% url "organizations:list" %}">{% trans "Create account" %}</a>
        </div>
      </div>
    </section>
  </div>
</article>
{% else %}
<article id="organization_list" class="sidebar-layout">
  <aside class="sidebar">
    <nav>
      <a href="{% url "users:detail" username=user.username %}" class="btn small ghost primary">
        {% include "core/icons/chevron-left.svg" %}
        {% trans "Back to your account" %}
      </a>
      <ul>
        <li>
          <a href="#org_search" class="nav-item">
            {% include "core/icons/search.svg" %}
            {% trans "Search" %}
          </a>
        </li>

        <li>
          <a href="#your-orgs" class="nav-item">
            {% include "core/icons/people.svg" %}
            {% trans "Your organizations" %}
          </a>
        </li>

        <li>
          <a href="#invitations" class="nav-item">
            {% include "core/icons/mail.svg" %}
            {% trans "Pending invitations" %}
          </a>
        </li>

        <li>
          <a href="#requests" class="nav-item">
            {% include "core/icons/smiley.svg" %}
            {% trans "Pending requests" %}
          </a>
        </li>
      </ul>

      <a href="{% url "organizations:create" %}" class="btn ghost primary create">
        {% include "core/icons/plus-circle.svg" %}
        {% trans "Create organization" %}
      </a>
    </nav>
  </aside>

  <main class="content">
    <header>
      <h1>{% trans "Organizations" %}</h1>
    </header>
    <section class="search">
      <h2>{% trans "Search organizations" %}</h2>
      <div id="org_search"></div>
    </section>

    <section id="your-orgs" class="your-orgs">
      <h2>{% trans "Your organizations" %}</h2>
      <div class="card">
        {% include "organizations/your_organizations.html" %}
      </div>
    </section>

    <section class="invites">
      {% if not has_verified_email %}
      <div class="empty">
        <p>
          {% blocktrans %}
          You must verify your email address before you can send requests
          or receive invitations to join an organization.
          {% endblocktrans %}
        </p>
        <form class="email-actions" action="{% url "account_email" %}" method="post">
          {% csrf_token %}
          <input type="hidden" name="email" value="{{user.email}}" />
          <button class="btn primary small" type="submit" name="action_send">
            {% trans "Confirm your email address" %}
          </button>
        </form>
      </div>
      {% else %}
        {% if potential_orgs %}
        <div id="pre-approved" class="pre-approved">
          <header>
            <h2>{% trans "Pre-approved" %}</h2>
            <p>{% trans "Based on your email address, you're pre-approved to join:" %}</p>
          </header>
          <div class="card">
            {% for organization in potential_orgs %}
            <div class="invite">
              {% include "account/team_list_item.html" %}

              <form method="post" action="{% url "organizations:detail" slug=organization.slug %}" class="actions join">
                {% csrf_token %}
                <button class="btn small primary" name="action" value="join">
                  <img src="{% static "icons/check.svg" %}">
                  {% trans "Join" %}
                </button>
              </form>
            </div>
            {% empty %}
            <div class="empty">
              <p>{% trans "No pre-approved teams are available to join." %}</p>
            </div>
            {% endfor %}
          </div>
        </div>
        {% endif %}

        <div id="invitations" class="pending">
          <header>
            <h2>{% trans "Pending invitations" %}</h2>
            <div class="header-actions">
              <a href="{% url "users:invitations" username=user.username %}" class="btn ghost primary">
                {% include "core/icons/history.svg" %}
                {% trans "Invitation history" %}
              </a>
            </div>
          </header>
          {% if pending_invitations|length > 0 %}
          <div class="card">
            {% for invite in pending_invitations %}
            <div class="invite">
              {% include "account/team_list_item.html" with organization=invite.organization %}

              <form method="post" action="{% url "organizations:invitation" uuid=invite.uuid %}" class="actions">
                {% csrf_token %}
                <button class="btn small primary" type="submit" name="action" value="accept">
                  {% trans "Accept" %}
                </button>
                <button class="btn small danger ghost" type="submit" name="action" value="reject">
                  {% trans "Reject" %}
                </button>
              </form>
            </div>
            {% endfor %}
          </div>
          {% else %}
          <div class="empty">
            <p>{% trans "No pending invitations." %}</p>
          </div>
          {% endif %}
        </div>

        <div id="requests" class="pending">
          <header>
            <h2>{% trans "Pending requests" %}</h2>
            <div class="header-actions">
              <a href="{% url "users:requests" username=user.username %}" class="btn ghost primary">
                {% include "core/icons/history.svg" %}
                {% trans "Request history" %}
              </a>
            </div>
          </header>
          {% if pending_requests|length > 0 %}
          <div class="card">
            {% for invite in pending_requests %}
            <div class="invite">
              {% include "account/team_list_item.html" with organization=invite.organization %}

              <form method="post" action="{% url "organizations:invitation" uuid=invite.uuid %}" class="actions">
                {% csrf_token %}
                <button class="btn small danger ghost" type="submit" name="action" value="reject">
                  {% trans "Withdraw request" %}
                </button>
              </form>
            </div>
            {% endfor %}
          </div>
          {% else %}
          <div class="empty">
            <p>{% trans "No pending requests." %}</p>
          </div>
          {% endif %}
        </div>
      {% endif %}
    </section>
  </main>
</article>
{% endif %}
{% endblock content %}

{% block extra_javascript %}

{% endblock extra_javascript %}
