{% extends "base.html" %}
{% load static i18n avatar django_vite %}

{% block title %}Organizations{% endblock %}


{% block vite %}
{{ block.super }}
{% vite_asset 'frontend/views/organization_list.ts' %}
{% endblock vite %}

{% block content %}
<article id="organization_list">
  <header>
    {% if user.is_authenticated %}
    <nav class="links">
      <a href="{% url "users:detail" username=user.username %}">
        {% include "core/icons/arrow-left.svg" %}
        {% trans "Back to your account" %}
      </a>
      <div class="create">
        <a href="{% url "organizations:create" %}" class="btn ghost">
          {% include "core/icons/plus-circle.svg" %}
          {% trans "Create organization" %}
        </a>
      </div>
    </nav>
    {% endif %}
    <h1>{% trans "Join an organization" %}</h1>
  </header>

  <div class="content">
    <section class="search">
      <h2>{% trans "Find an organization to join" %}</h2>
      <div id="org_search"></div>
    </section>

    <section class="invites">
      {% if not has_verified_email %}
      <div class="empty">
        <p>
          {% blocktrans %}
          You must verify your email address before you can send requests
          or receieve invitations to join an organization.
          {% endblocktrans %}
        </p>
      </div>
      {% elif not has_pending %}
      <div class="empty">
        <p>{% trans "You don't have any outstanding invitations." %}</p>
        <p>{% trans "Any invitations you receive will appear here." %}</p>
      </div>
      {% else %}
        {% if potential_orgs %}
        <div class="pre-approved">
          <header>
            <h2>{% trans "Pre-approved" %}</h2>
            <p>{% trans "Based on your email address, you're pre-approved to join:" %}</p>
          </header>
          <div class="orgs">
            {% for organization in potential_orgs %}
            <div class="invite">
              {% include "account/team_list_item.html" %}
              
              <form method="post" action="{% url "organizations:detail" slug=organization.slug %}" class="actions join">
                {% csrf_token %}
                <button class="button primary" name="action" value="join">
                  <img src="{% static "icons/check.svg" %}">
                  {% trans "Join" %}
                </button>
              </form>
            </div>
            {% empty %}
            <div class="empty">
              <p>{% trans "No pre-approved teams are available to join." %}</p>
            </div>
            {% endfor %}
          </div>
        </div>
        {% endif %}

        {% if pending_invitations %}
        {{pending_invitations}}
        <div class="pending">
          <h2>{% trans "Pending invitations" %}</h2>
          <div class="orgs">
            {% for invite in pending_invitations %}
            <div class="invite">
              {% include "account/team_list_item.html" with organization=invite.organization %}
              
              <form method="post" action="{% url "organizations:invitation" uuid=invite.uuid %}" class="actions">
                {% csrf_token %}
                <button class="btn primary ghost" type="submit" name="action" value="accept">
                  {% trans "Accept" %}
                </button>
                <button class="btn danger ghost" type="submit" name="action" value="reject">
                  {% trans "Reject" %}
                </button>
              </form>
            </div>
            {% empty %}
            <div class="empty">
              <p>{% trans "No pending invitations." %}</p>
            </div>
            {% endfor %}
          </div>
        </div>
        {% endif %}

        {% if pending_requests %}
        <div class="pending">
          <h2>{% trans "Pending requests" %}</h2>
          
          <div class="orgs">
            {% for invite in pending_requests %}
            <div class="invite">
              {% include "account/team_list_item.html" with organization=invite.organization %}

              <form method="post" action="{% url "organizations:invitation" uuid=invite.uuid %}" class="actions">
                {% csrf_token %}
                <button class="btn danger ghost" type="submit" name="action" value="reject">
                  {% trans "Withdraw" %}
                </button>
              </form>
            </div>
            {% empty %}
            <div class="empty">
              <p>{% trans "No pending requests." %}</p>
            </div>
            {% endfor %}
          </div>
        </div>
        {% endif %}
      {% endif %}
    </section>
  </div>
</article>
{% endblock content %}

{% block extra_javascript %}

{% endblock extra_javascript %}