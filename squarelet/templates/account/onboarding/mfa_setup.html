{% extends "account/onboarding/base.html" %}

{% load i18n static django_vite %}
{% load account socialaccount %}

{% block vite %}
{{ block.super }}
{% vite_asset "frontend/views/mfa.ts" %}
{% endblock %}

{% block onboarding_step_id %}onboarding-mfa-setup{% endblock %}

{% block onboarding_step %}
  <header>
    <h1>{% trans "Enable two-factor authentication" %}</h1>
  </header>
  <div class="flex qr-code-container">
    <div class="code">
      <img src="{{ totp_svg_data_uri }}" alt="QR code for enabling two-factor authentication" />
    </div>
    <div class="instructions">
      <p>
        {% blocktranslate %}To enable two-factor authentication, scan this QR code with an authenticator app. Then, input the verification code generated by the app into the field below.{% endblocktranslate %}
      </p>
      <p>
        {% blocktranslate %}For future sign-ins, you will use the same app to generate a secure, one-time code to authenticate yourself.{% endblocktranslate %}
      </p>
    </div>
  </div>
  {% if form.code.errors %}
    {{ form.code.errors }}
  {% endif %}
  <form class="flex gap-1 align-end m-0" method="post" action="{% url 'account_onboarding' %}">
    {% csrf_token %}
    <input type="hidden" name="step" value="mfa_setup" />
    <input type="hidden" name="secret" value="{{ form.secret }}" />
    <label class="field">
      {% trans "Enter your 6-digit code" %}
      <input type="text" name="code" placeholder="{% trans "######" %}" />
    </label>
    <button class="button primary" type="submit" name="mfa_setup" value="code">{% trans "Submit" %}</button>
    <button class="button primary ghost" type="submit" name="mfa_setup" value="skip">{% trans "Skip" %}</button>
  </form>
  <div class="help-box">
    <h4>Which app should I use?</h4>
    <ul>
      <li><strong>On iOS:</strong> the <a href="https://apps.apple.com/us/app/passwords/id6473799789" target="_blank">Apple Passwords app</a> is used by default to scan the QR code and generate secure, one-time login codes.</li>
      <li><strong>On Android:</strong> the <a href="https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2&hl=en_US&pli=1" target="_blank">Google Authenticator app</a> can be installed from the Google Play Store to scan the QR code and generate secure, one-time login codes.</li>
      <li><strong>Third party:</strong> <a href="https://1password.com/" target="_blank">1Password</a>, <a href="https://2fas.com/" target="_blank">2FAS</a>, and other two-factor authentication apps may also be used.</li>
    </ul>
    <p><a href="https://help.muckrock.com/Two-Factor-Authentication-1f9f8892696380e59857c19341a324af?pvs=25#207f88926963803bb47ecaa9f2a2b875" class="btn primary ghost">Read our documentation for more</a></p>
  </div>
{% endblock %}