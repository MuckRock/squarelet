{% extends "base.html" %}
{% load i18n django_vite %}

{% block title %}
    {% translate "Activate Authenticator App" %}
{% endblock title %}

{% block vite %}
  {{ block.super }}
  {% vite_asset "frontend/views/mfa.ts" %}
{% endblock vite %}

{% block content %}
<div class="container" id="activate-mfa">
  <header>
    <a class="nav-link" href="{% url 'users:detail' user.username %}">
      {% include "core/icons/arrow-left.svg" %}
      {% trans "Return to your account" %}
    </a>
    <h1>{% translate "Activate Authenticator App" %}</h1>
  </header>
  <main>
    <p>
      {% blocktranslate %}To activate two-factor authentication, scan the QR code below with an authenticator app. Then, input the verification code generated by the app into the field below.{% endblocktranslate %}
    </p>

    {% if form.non_field_errors %}
    <div class="errors">
      {% for error in form.non_field_errors %}
      <p class="error">{{ error }}</p>
      {% endfor %}
    </div>
    {% endif %}

    <form method="post" action="{% url 'mfa_activate_totp' %}">
      {% csrf_token %}
      <img id="qr-code" src="{{totp_svg_data_uri}}" alt="{{form.secret}}" />
      <div class="column">
        <label class="field" id="authenticator_secret">
          <span class="field-label">{% translate "Authenticator secret" %}</span>
          <input type="text" value="{{form.secret}}" disabled readonly />
          <p class="help">
            {% translate "You can store this secret and use it to reinstall your authenticator app at a later time." %}
          </p>
        </label>
        <label class="field{% if form.code.errors %} has-errors{% endif %}" id="authenticator_code">
          <span class="field-label">{% translate "Authenticator code" %}</span>
          <input type="text" name="code" value="" placeholder="XXXXXX" />
          {% for error in form.code.errors %}<p class="error">{{ error }}</p>{% endfor %}
          <p class="help">
            {% translate "Enter the code generated by your authenticator app." %}
          </p>
        </label>
        <button type="submit" class="btn primary">
          {% trans "Activate" %}
        </button>
      </div>
    </form>

    <div class="help-box">
      <h4>Which app should I use?</h4>
      <ul>
        <li><strong>On iOS:</strong> the <a href="https://apps.apple.com/us/app/passwords/id6473799789" target="_blank">Apple Passwords app</a> is used by default to scan the QR code and generate secure, one-time login codes.</li>
        <li><strong>On Android:</strong> the <a href="https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2&hl=en_US&pli=1" target="_blank">Google Authenticator app</a> can be installed from the Google Play Store to scan the QR code and generate secure, one-time login codes.</li>
        <li><strong>Third party:</strong> <a href="https://1password.com/" target="_blank">1Password</a>, <a href="https://2fas.com/" target="_blank">2FAS</a>, and other two-factor authentication apps may also be used.</li>
      </ul>
      <p><a href="https://help.muckrock.com/Two-Factor-Authentication-1f9f8892696380e59857c19341a324af?pvs=25#207f88926963803bb47ecaa9f2a2b875" class="btn primary ghost">Read our documentation for more</a></p>
    </p>
  </main>
</div>
{% endblock content %}
